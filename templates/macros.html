<!-- templates/macros.html -->
{% macro link_item(link, show_user=True, current_user=None) %}
<div class="bookmark">
    <a class="bookmark-title" href="{{ link.url }}">{{ link.title }}</a>
    {% if link.description %}
        <div class="description">
            {{ link.description }}
        </div>
    {% endif %}
    {% if link.tags %}
        <div class="tags">
            {% for tag in link.tags %}
                {% if not tag.name.startswith('.') or (current_user and current_user.is_authenticated and link.user_id == current_user.id) %}
                    <a class="tag" href="{{ url_for('tag_links', tag_name=tag.name) }}">{{ tag.name }}</a>
                {% endif %}
            {% endfor %}
        </div>
        <span class="saved-on when">{{ link.created_at | format_relative_time }}</span>    
        {% if show_user and link.user %}
            by <a href="{{ url_for('user_links', username=link.user.username) }}">{{ link.user.username }}</a>
        {% endif %}
    {% endif %}
    {% if current_user and current_user.is_authenticated and link.user_id == current_user.id %}
        <span class="manipulate">
            <a class="edit" href="{{ url_for('edit_link', link_id=link.id) }}">Edit</a>
            <!-- Delete as a styled link -->
            <form action="{{ url_for('delete_link', link_id=link.id) }}" method="post" class="delete-form">
                <!-- Correctly include the CSRF token as a hidden input -->
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="delete-link">Delete</button>
            </form>
            {% if link.read_later %}
                <a href="{{ url_for('mark_as_read', link_id=link.id) }}">Mark as Read</a>
            {% endif %}
        </span>
    {% endif %}
</div>
{% endmacro %}
